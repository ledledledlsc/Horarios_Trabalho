<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Horários de Trabalho</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f8f9fa;
    text-align: center;
    padding: 20px;
  }
  #semanaTitulo {
    font-size: 26px;
    color: #007bff;
    margin-bottom: 10px;
  }
  .buttons {
    margin: 15px 0;
  }
  button {
    margin: 5px;
    padding: 10px 15px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    background: #007bff;
    color: white;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover { background: #0056b3; }

  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 700px;
    margin: 0 auto 40px;
    background: white;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid black;
    padding: 8px;
    width: 14.28%;
    word-wrap: break-word;
  }

  .green     { background-color: #27ae60; color: white; }
  .red       { background-color: #e74c3c; color: white; }
  .gray      { background-color: #bdc3c7; color: black; }
  .darkgray  { background-color: #2c3e50; color: white; }
  .blue      { background-color: #3498db; color: white; }

  .today { border: 3px solid orange; text-decoration: underline; font-weight: bold; }

  @media(max-width: 600px) {
    th, td { font-size: 14px; padding: 6px; }
    #semanaTitulo { font-size: 20px; }
    button { font-size: 14px; padding: 8px 12px; }
  }
</style>
</head>
<body>

<h1>Horários de Trabalho</h1>
<div id="semanaTitulo"></div>
<div class="buttons">
  <button id="prevWeek">Semana anterior</button>
  <button id="nextWeek">Próxima semana</button>
</div>
<table id="horarios">
  <tbody></tbody>
</table>

<script>
const GITHUB_CSV_URL = 'https://raw.githubusercontent.com/ledledledlsc/Horarios_Trabalho/main/Horarios_Trabalho.csv';
let semanas = [];
let semanaAtual = 0;
let linhasCache = [];

// Carregar CSV e detectar semanas
async function carregarCSV() {
  const res = await fetch(GITHUB_CSV_URL);
  const text = await res.text();
  linhasCache = text.split('\n').map(l => l.split(','));

  // Detectar semanas
  semanas = [];
  let i = 0;
  while(i < linhasCache.length) {
    if(linhasCache[i][0] && linhasCache[i][0].toUpperCase().includes('SEMANA')) {
      let start = i;
      let end = start + 2; // título + datas + horários
      while(end + 1 < linhasCache.length && linhasCache[end + 1][0] && !linhasCache[end + 1][0].toUpperCase().includes('SEMANA')) {
        end++;
      }
      semanas.push({start, end});
      i = end + 1;
    } else {
      i++;
    }
  }
  mostrarSemana(semanaAtual);
}

// Mostrar semana no site
function mostrarSemana(index) {
  const tbody = document.querySelector('#horarios tbody');
  tbody.innerHTML = '';
  const semana = semanas[index];

  // Título centrado
  document.getElementById('semanaTitulo').textContent = linhasCache[semana.start][0];

  for(let i = semana.start + 1; i <= semana.end; i++) {
    const tr = document.createElement('tr');
    linhasCache[i].forEach((celula, j) => {
      const td = document.createElement(i === semana.start + 1 ? 'th' : 'td');
      td.textContent = celula;

      // Aplica cores conforme o texto
      const valor = celula.toLowerCase();
      if(valor.includes('libre')) td.classList.add('darkgray');
      else if(valor.includes('escola')) td.classList.add('gray');
      else if(valor.includes('feriado')) td.classList.add('red');
      else if(valor.includes('7-17') || valor.includes('10-17') || valor.includes('13-20')) td.classList.add('blue');
      else if(valor.includes('7-13') || valor.includes('6:30-12') || valor.includes('8-13') || valor.includes('7-12:30')) td.classList.add('green');

      // Destacar o dia atual
      if(i === semana.start + 2) {
        const hoje = new Date();
        const diaHoje = `${hoje.getDate()}-${hoje.getMonth()+1}`.padStart(5,'0');
        if(td.textContent.includes(diaHoje)) td.classList.add('today');
      }

      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  }
}

// Botões
document.getElementById('prevWeek').addEventListener('click', () => {
  if(semanaAtual > 0) semanaAtual--;
  mostrarSemana(semanaAtual);
});
document.getElementById('nextWeek').addEventListener('click', () => {
  if(semanaAtual < semanas.length - 1) semanaAtual++;
  mostrarSemana(semanaAtual);
});

// Inicializar
carregarCSV();
</script>

</body>
</html>
