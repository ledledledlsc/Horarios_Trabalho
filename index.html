<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Hor√°rios de Trabalho</title>

<!-- PWA / APP -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">

<!-- iPhone / Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Hor√°rios">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #e9f0ff, #f7f9fc);
    text-align: center;
    padding: 20px;
  }

  h1 { color: #007bff; margin-bottom: 10px; }
  #semanaTitulo { font-size: 26px; color: #333; margin-bottom: 15px; }

  .buttons { margin-bottom: 16px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
  button {
    margin: 5px; padding: 10px 15px; font-size: 16px;
    border-radius: 10px; border: none; background: #007bff;
    color: white; cursor: pointer; transition: 0.2s;
  }
  button:hover { background: #0056b3; }

  #feriasBtn { background:#8e44ad; }
  #feriasBtn:hover { background:#6f2f8a; }
  #feriasBadge {
    display:none;
    margin-left:8px;
    background: #ffcc00;
    color: #2c3e50;
    padding: 2px 8px;
    border-radius: 999px;
    font-weight: bold;
    font-size: 12px;
    vertical-align: middle;
  }

  /* cards acima */
  #feriasAviso, #proximasFerias{
    display:none;
    width: 100%;
    max-width: 900px;
    margin: 0 auto 12px;
    padding: 10px 12px;
    border-radius: 10px;
    font-weight: bold;
    opacity: 0;
    transform: translateY(-6px);
    transition: opacity .25s ease, transform .25s ease;
    text-align: center;
  }
  #feriasAviso{ background: #fff3cd; border: 1px solid #ffeeba; color: #856404; }
  #proximasFerias{ background: #eef6ff; border: 1px solid #cfe6ff; color: #1d4e89; }

  #feriasAviso.show, #proximasFerias.show{
    display:block; opacity:1; transform: translateY(0);
  }

  /* ---------- TABELA (DESKTOP) ---------- */
  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 900px;
    margin: 0 auto 26px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    background: white;
    border-radius: 12px;
    overflow: hidden;
  }
  th, td { border: 1px solid #ccc; padding: 12px; width: 14.28%; word-wrap: break-word; font-size: 16px; }
  th { background: #e9ecef; }

  .green { background-color: #27ae60; color: white; }
  .red { background-color: #e74c3c; color: white; }
  .gray { background-color: #bdc3c7; color: black; }
  .darkgray { background-color: #2c3e50; color: white; }
  .blue { background-color: #3498db; color: white; }
  .blue-dark { background-color: #1d4e89; color: white; font-weight: bold; }

  .today { border: 4px solid orange; font-weight: bold; text-decoration: underline; box-shadow: 0 0 10px rgba(255,165,0,0.55); }

  /* notas (4¬™ linha) */
  .notesRow td { font-size: 14px; background: #fff; color: #333; font-style: italic; }
  .noteCell { border-top: 2px dashed #bbb; background: #fafafa; }

  /* f√©rias na c√©lula */
  .vacCell {
    background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
    color: #2c3e50;
    font-weight: bold;
  }

  /* quando semana inteira √© f√©rias */
  .weekVacTable {
    outline: 4px solid rgba(253,203,110,0.55);
    box-shadow: 0 0 18px rgba(253,203,110,0.35);
  }

  /* ---------- LEGENDA ---------- */
  #legenda { display:flex; justify-content:center; flex-wrap:wrap; margin-bottom: 16px; gap: 12px; }
  .itemLegenda { display:flex; align-items:center; gap:6px; font-size: 14px; }
  .colorBox { width: 18px; height: 18px; display:inline-block; border-radius: 4px; }
  .colorBox.vac { background: linear-gradient(135deg, #ffeaa7, #fdcb6e); border: 1px solid rgba(0,0,0,0.12); }

  /* ---------- MODAL F√âRIAS ---------- */
  .modal-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display:none;
    align-items:center;
    justify-content:center;
    padding:16px;
    z-index:9999;
  }
  .modal{
    width: min(520px, 100%);
    background: white;
    border-radius: 14px;
    padding: 16px;
    text-align:left;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    color:#000;
  }
  .modal h3{ margin:0 0 10px; font-size: 20px; color:#000; }
  .modal ul{ margin:0 0 12px; padding-left:18px; line-height:1.6; }
  .modal ul li{ color:#000; font-weight:500; font-size:15px; margin-bottom:6px; }
  .modal .actions{ display:flex; justify-content:flex-end; gap:10px; }
  .btn-close{ background:#2c3e50; color:#fff; }
  .btn-close:hover{ background:#1d2a36; }

  /* ---------- LOGO ---------- */
  .footer-logo {
    margin-top: 18px;
    padding-top: 12px;
    display: flex;
    justify-content: center;
    opacity: 0;
    transform: translateY(6px);
    transition: opacity .25s ease, transform .25s ease;
  }
  .footer-logo.show { opacity: 0.35; transform: translateY(0); }
  .footer-logo img { height: 42px; max-width: 180px; object-fit: contain; }
  .footer-logo img:hover { opacity: 0.85; }

  /* ---------- MOBILE VIEW (CARDS) ---------- */
  #mobileView{
    display:none;
    max-width: 900px;
    margin: 0 auto 18px;
    text-align:left;
  }
  .mobileGrid{
    display:grid;
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .dayCard{
    background: rgba(255,255,255,0.95);
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 14px;
    padding: 12px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.06);
    display:flex;
    gap: 12px;
    align-items: center;
    justify-content: space-between;
  }
  .dayLeft{
    display:flex;
    flex-direction: column;
    gap: 6px;
  }
  .dayTitle{
    font-weight: 800;
    font-size: 16px;
    color:#1d2a36;
  }
  .dayDate{
    font-size: 13px;
    opacity: .75;
  }
  .dayRight{
    text-align:right;
    min-width: 120px;
  }
  .shiftBig{
    font-weight: 900;
    font-size: 18px;
    padding: 8px 10px;
    border-radius: 12px;
    display:inline-block;
  }
  .shiftSmall{
    margin-top: 6px;
    font-size: 13px;
    opacity: .85;
  }

  /* cores para o badge grande */
  .b-green{ background:#27ae60; color:#fff; }
  .b-red{ background:#e74c3c; color:#fff; }
  .b-blue{ background:#3498db; color:#fff; }
  .b-bluedark{ background:#1d4e89; color:#fff; }
  .b-gray{ background:#bdc3c7; color:#000; }
  .b-darkgray{ background:#2c3e50; color:#fff; }
  .b-vac{ background: linear-gradient(135deg, #ffeaa7, #fdcb6e); color:#2c3e50; }
  .b-default{ background:#eef2f7; color:#1d2a36; border:1px solid rgba(0,0,0,0.08); }

  .cardToday{
    outline: 3px solid rgba(255,165,0,0.9);
    box-shadow: 0 10px 22px rgba(255,165,0,0.18);
  }

  /* esconde tabela no mobile e mostra cards */
  @media(max-width: 900px){
    table{ display:none; }
    #mobileView{ display:block; }
    #semanaTitulo{ font-size: 20px; }
    button{ font-size: 14px; padding: 9px 12px; border-radius: 12px; }
    body{ padding: 14px; }
  }

  /* modo escuro */
  @media (prefers-color-scheme: dark) {
    body { background: linear-gradient(135deg, #121212, #1e1e1e); color: #eaeaea; }
    #semanaTitulo { color: #eaeaea; }
    table { background: #1f1f1f; }
    th { background: #2a2a2a; color: #ffffff; }
    th, td { border-color: #444; }
    .notesRow td { background: #1f1f1f; color: #eaeaea; }
    .noteCell { background: #222; border-top-color: #555; }

    #proximasFerias { background:#13283b; border-color:#214563; color:#bfe1ff; }
    #feriasAviso { background:#3a2f12; border-color:#6a5520; color:#ffe9b0; }

    .dayCard{ background: rgba(30,30,30,0.95); border-color: rgba(255,255,255,0.08); }
    .dayTitle{ color:#ffffff; }
    .dayDate{ opacity: .75; }
    .b-default{ background:#1b2430; color:#eaeaea; border-color: rgba(255,255,255,0.10); }
    .footer-logo.show { opacity: 0.7; }
    .footer-logo img { filter: brightness(1.35) contrast(1.1); }
  }
</style>
</head>
<body>

<h1>Hor√°rios de Trabalho</h1>

<div id="feriasAviso"></div>
<div id="proximasFerias"></div>

<div id="semanaTitulo"></div>
<div class="buttons">
  <button id="prevWeek">Semana anterior</button>
  <button id="nextWeek">Pr√≥xima semana</button>
  <button id="feriasBtn">üèñÔ∏è F√©rias <span id="feriasBadge">AGORA</span></button>
</div>

<div id="legenda">
  <div class="itemLegenda"><span class="colorBox blue"></span> dia</div>
  <div class="itemLegenda"><span class="colorBox blue-dark"></span> Chambre de commerce</div>
  <div class="itemLegenda"><span class="colorBox green"></span> manh√£</div>
  <div class="itemLegenda"><span class="colorBox red"></span> tarde</div>
  <div class="itemLegenda"><span class="colorBox gray"></span> Escola</div>
  <div class="itemLegenda"><span class="colorBox darkgray"></span> Livre</div>
  <div class="itemLegenda"><span class="colorBox vac"></span> F√©rias</div>
</div>

<!-- MOBILE VIEW -->
<div id="mobileView">
  <div class="mobileGrid" id="mobileCards"></div>
</div>

<!-- DESKTOP TABLE -->
<table id="horarios"><tbody></tbody></table>

<!-- POPUP F√âRIAS -->
<div class="modal-overlay" id="feriasOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="feriasTitle">
    <h3 id="feriasTitle">üèñÔ∏è F√©rias</h3>
    <ul id="feriasList"></ul>
    <div class="actions">
      <button class="btn-close" id="feriasClose">Fechar</button>
    </div>
  </div>
</div>

<!-- LOGO -->
<div class="footer-logo" id="footerLogo">
  <a href="https://www.cactus.lu/fr" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Cactus_Logo.svg/960px-Cactus_Logo.svg.png" alt="Logo Cactus">
  </a>
</div>

<script>
/* LINKS */
const GITHUB_CSV_URL = 'https://raw.githubusercontent.com/ledledledlsc/Horarios_Trabalho/main/Horarios_Trabalho.csv';
const FERIAS_CSV_URL = 'https://raw.githubusercontent.com/ledledledlsc/Horarios_Trabalho/main/Ferias.csv';

/* CONFIG */
const diasSemana = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
const meses = ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'];

let semanas = [];
let semanaAtual = 0;
let linhasCache = [];
let FERIAS_RANGES = [];
let ESTA_DE_FERIAS = false;

/* HELPERS */
function normalizeCell(x){ return (x === null || x === undefined) ? '' : String(x).trim(); }
function toDateOnly(d){ const x=new Date(d); x.setHours(0,0,0,0); return x; }
function inRange(today, start, end){
  const t = toDateOnly(today).getTime();
  const s = toDateOnly(start).getTime();
  const e = toDateOnly(end).getTime();
  return t >= s && t <= e;
}
function parseCSVLines(text){
  const lines = (text || '').trim().split(/\r?\n/).filter(Boolean);
  return lines.map((line) => {
    const hasTab = line.includes('\t');
    const hasComma = line.includes(',');
    const hasSemi = line.includes(';');
    let sep = ',';
    if (hasTab) sep = '\t';
    else if (!hasComma && hasSemi) sep = ';';
    return line.split(sep).map(x => String(x).replace(/^"|"$/g,'').trim());
  });
}
function parseDateSafe(s){
  const t = normalizeCell(s);
  if(!t) return null;
  const m = t.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if(m){
    const y=+m[1], mo=+m[2]-1, d=+m[3];
    const dt = new Date(y, mo, d);
    dt.setHours(0,0,0,0);
    return dt;
  }
  const dt = new Date(t);
  if(isNaN(dt)) return null;
  dt.setHours(0,0,0,0);
  return dt;
}
function fmtDateShort(dt){
  return `${String(dt.getDate()).padStart(2,'0')}/${meses[dt.getMonth()]}/${dt.getFullYear()}`;
}
function daysBetween(a, b){
  const ms = 24*60*60*1000;
  return Math.round((toDateOnly(b).getTime() - toDateOnly(a).getTime()) / ms);
}

/* F√âRIAS */
function parseFeriasCSV(text){
  const lines = parseCSVLines(text);
  if(lines.length <= 1) return [];
  const headers = lines[0].map(h => h.toLowerCase());
  const idxStart = headers.indexOf('start');
  const idxEnd = headers.indexOf('end');
  const idxLabel = headers.indexOf('label');
  if(idxStart < 0 || idxEnd < 0) return [];

  return lines.slice(1).map(row => {
    const startStr = normalizeCell(row[idxStart]);
    const endStr   = normalizeCell(row[idxEnd]);
    const startDt  = parseDateSafe(startStr);
    const endDt    = parseDateSafe(endStr);
    return { startStr, endStr, startDt, endDt, label: idxLabel>=0 ? normalizeCell(row[idxLabel]) : '' };
  }).filter(r => r.startDt && r.endDt);
}
function fmtFeriasRange(r){
  return `${fmtDateShort(r.startDt)} ‚Üí ${fmtDateShort(r.endDt)}${r.label ? ' ‚Äî ' + r.label : ''}`;
}
function getCurrentVacationRange(today){
  return FERIAS_RANGES.find(r => inRange(today, r.startDt, r.endDt)) || null;
}
function getVacationForDate(date){
  return FERIAS_RANGES.find(r => inRange(date, r.startDt, r.endDt)) || null;
}
function getNextVacation(today){
  const t = toDateOnly(today);
  const future = FERIAS_RANGES
    .filter(r => toDateOnly(r.startDt).getTime() > t.getTime())
    .sort((a,b) => a.startDt - b.startDt);
  return future[0] || null;
}
async function carregarFeriasCSV(){
  try{
    const res = await fetch(FERIAS_CSV_URL + '?cache=' + new Date().getTime());
    const text = await res.text();
    FERIAS_RANGES = parseFeriasCSV(text);
  }catch(e){
    console.log('Erro ao carregar f√©rias:', e);
    FERIAS_RANGES = [];
  }
}
function updateTopCards(){
  const hoje = new Date(); hoje.setHours(0,0,0,0);

  const badge = document.getElementById('feriasBadge');
  const aviso = document.getElementById('feriasAviso');
  const prox  = document.getElementById('proximasFerias');
  const footerLogo = document.getElementById('footerLogo');

  // lista modal
  const ul = document.getElementById('feriasList');
  ul.innerHTML = '';
  if(!FERIAS_RANGES.length){
    const li = document.createElement('li');
    li.textContent = 'Sem f√©rias encontradas (confirma o Ferias.csv).';
    ul.appendChild(li);
  } else {
    FERIAS_RANGES.forEach(r=>{
      const li = document.createElement('li');
      li.textContent = fmtFeriasRange(r);
      ul.appendChild(li);
    });
  }

  const current = getCurrentVacationRange(hoje);
  ESTA_DE_FERIAS = !!current;

  if(ESTA_DE_FERIAS){
    badge.style.display = 'inline-block';
    aviso.textContent = `üèñÔ∏è Est√°s de f√©rias agora: ${fmtFeriasRange(current)}`;
    aviso.classList.add('show');

    prox.classList.remove('show');
    prox.style.display = 'none';
  } else {
    badge.style.display = 'none';
    aviso.classList.remove('show');

    const next = getNextVacation(hoje);
    if(next){
      const dias = daysBetween(hoje, next.startDt);
      prox.textContent = `üîî Pr√≥ximas f√©rias em ${dias} dia${dias===1?'':'s'}: ${fmtFeriasRange(next)}`;
      prox.classList.add('show');
    } else {
      prox.classList.remove('show');
      prox.style.display = 'none';
    }
  }

  // logo
  if(footerLogo){
    if(ESTA_DE_FERIAS){
      footerLogo.classList.remove('show');
      setTimeout(() => { footerLogo.style.display = 'none'; }, 260);
    } else {
      footerLogo.style.display = 'flex';
      setTimeout(() => footerLogo.classList.add('show'), 20);
    }
  }
}

/* HOR√ÅRIOS */
function classificarHorario(horario){
  horario = normalizeCell(horario).replace(/\s/g,'').replace(/h/gi,'');
  const parts = horario.split('-');
  if(parts.length !== 2) return '';
  let inicio = parseFloat(parts[0].replace(':','.'));
  let fim    = parseFloat(parts[1].replace(':','.'));
  if(inicio === 7 && fim === 17) return 'blue-dark';
  if(inicio >= 12 && fim <= 21) return 'red';
  if(inicio >= 5 && fim <= 13) return 'green';
  if(inicio >= 10 && fim <= 17) return 'blue';
  return '';
}
function badgeClassForCell(cell){
  const v = normalizeCell(cell).toLowerCase();
  const c = classificarHorario(cell);
  if(v.includes('escola')) return 'b-gray';
  if(v.includes('feriado')) return 'b-red';
  if(v.includes('libre') || v.includes('livre')) return 'b-darkgray';
  if(c === 'green') return 'b-green';
  if(c === 'red') return 'b-red';
  if(c === 'blue') return 'b-blue';
  if(c === 'blue-dark') return 'b-bluedark';
  return 'b-default';
}
function niceDayTitle(dateObj){
  const ds = diasSemana[dateObj.getDay()];
  return ds;
}
function niceDayDate(dateObj){
  return `${dateObj.getDate()}/${meses[dateObj.getMonth()]}`;
}

async function carregarCSV() {
  const res = await fetch(GITHUB_CSV_URL + '?cache=' + new Date().getTime());
  const text = await res.text();
  linhasCache = text.split('\n').map(l => l.split(','));

  semanas = [];
  let i = 0;
  while(i < linhasCache.length) {
    if(linhasCache[i][0] && String(linhasCache[i][0]).toUpperCase().includes('SEMANA')) {
      let start = i;
      let end = start + 2;
      while(end + 1 < linhasCache.length &&
            linhasCache[end + 1][0] &&
            !String(linhasCache[end + 1][0]).toUpperCase().includes('SEMANA')) {
        end++;
      }
      semanas.push({start,end});
      i = end + 1;
    } else i++;
  }

  // semana atual
  const hoje = new Date(); hoje.setHours(0,0,0,0);
  for(let s=0;s<semanas.length;s++){
    const semana = semanas[s];
    const linhaDatas = linhasCache[semana.start+1] || [];
    if(linhaDatas.some(celula=>{
      const data = new Date(celula);
      if(isNaN(data)) return false;
      data.setHours(0,0,0,0);
      return data.getTime() === hoje.getTime();
    })){
      semanaAtual = s;
      break;
    }
  }

  mostrarSemana(semanaAtual);
}

function renderMobileCards(linhaDatas, linhaHorarios, linhaNotas){
  const wrap = document.getElementById('mobileCards');
  if(!wrap) return;
  wrap.innerHTML = '';

  const hoje = new Date(); hoje.setHours(0,0,0,0);

  for(let j=0; j<linhaDatas.length; j++){
    const rawDate = linhaDatas[j];
    const d = new Date(rawDate);
    if(isNaN(d)) continue;
    d.setHours(0,0,0,0);

    const vac = getVacationForDate(d);
    const isToday = d.getTime() === hoje.getTime();

    const card = document.createElement('div');
    card.className = 'dayCard' + (isToday ? ' cardToday' : '');

    const left = document.createElement('div');
    left.className = 'dayLeft';

    const t1 = document.createElement('div');
    t1.className = 'dayTitle';
    t1.textContent = `${niceDayTitle(d)} ‚Ä¢ ${niceDayDate(d)}`;

    const t2 = document.createElement('div');
    t2.className = 'dayDate';

    // nota pequena (se existir)
    const nota = (linhaNotas && linhaNotas[j]) ? normalizeCell(linhaNotas[j]) : '';
    t2.textContent = nota ? `üìù ${nota}` : '';

    left.appendChild(t1);
    if(nota) left.appendChild(t2);

    const right = document.createElement('div');
    right.className = 'dayRight';

    const big = document.createElement('div');
    big.className = 'shiftBig';

    if(vac){
      big.textContent = 'F√âRIAS';
      big.classList.add('b-vac');
    } else {
      const cell = normalizeCell(linhaHorarios[j] || '');
      big.textContent = cell || '‚Äî';
      big.classList.add(badgeClassForCell(cell));
    }

    const small = document.createElement('div');
    small.className = 'shiftSmall';
    if(vac && vac.label) small.textContent = `üèñÔ∏è ${vac.label}`;
    else if(isToday) small.textContent = 'Hoje';
    else small.textContent = '';

    right.appendChild(big);
    if(small.textContent) right.appendChild(small);

    card.appendChild(left);
    card.appendChild(right);
    wrap.appendChild(card);
  }
}

function mostrarSemana(index){
  // desktop table
  const tbody = document.querySelector('#horarios tbody');
  tbody.innerHTML='';

  const semana = semanas[index];
  if(!semana) return;

  const table = document.getElementById('horarios');
  table.classList.remove('weekVacTable');

  document.getElementById('semanaTitulo').textContent = normalizeCell(linhasCache[semana.start][0]);

  const linhaDatas = (linhasCache[semana.start+1] || []).map(normalizeCell);
  const linhaHorarios = (linhasCache[semana.start+2] || []).map(normalizeCell);

  const linhaNotasRaw = linhasCache[semana.start+3];
  const linhaNotas = linhaNotasRaw ? linhaNotasRaw.map(normalizeCell) : null;
  const temNotas = linhaNotas && linhaNotas.some(c => c && c.length > 0);

  // Cabe√ßalho
  const trHead = document.createElement('tr');
  linhaDatas.forEach(celula=>{
    const th = document.createElement('th');
    const data = new Date(celula);
    if(!isNaN(data)){
      const diaSemana = diasSemana[data.getDay()];
      const diaMes = data.getDate();
      const mes = meses[data.getMonth()];
      th.textContent = `${diaSemana} ${diaMes}/${mes}`;
    } else th.textContent = celula;
    trHead.appendChild(th);
  });
  tbody.appendChild(trHead);

  // Hor√°rios
  const trHorario = document.createElement('tr');
  const hoje = new Date(); hoje.setHours(0,0,0,0);

  let totalDiasValidos = 0;
  let diasFerias = 0;

  linhaHorarios.forEach((celula,j)=>{
    const td = document.createElement('td');

    const dataCelula = new Date(linhaDatas[j]);
    const ok = !isNaN(dataCelula);
    if(ok){
      dataCelula.setHours(0,0,0,0);
      totalDiasValidos++;

      const vac = getVacationForDate(dataCelula);
      if(vac){
        diasFerias++;
        td.textContent = 'F√âRIAS';
        td.classList.add('vacCell');
        td.title = vac.label ? `F√©rias: ${vac.label}` : 'F√©rias';
      } else {
        td.textContent = celula;
        const valor = String(celula || '').toLowerCase();
        const cor = classificarHorario(celula);

        if(cor) td.classList.add(cor);
        else if(valor.includes('escola')) td.classList.add('gray');
        else if(valor.includes('feriado')) td.classList.add('red');
        else if(valor.includes('libre') || valor.includes('livre')) td.classList.add('darkgray');
      }

      if(dataCelula.getTime() === hoje.getTime()){
        td.classList.add('today');
      }
    } else {
      td.textContent = celula;
    }

    trHorario.appendChild(td);
  });
  tbody.appendChild(trHorario);

  // semana toda f√©rias
  if(totalDiasValidos > 0 && diasFerias === totalDiasValidos){
    table.classList.add('weekVacTable');
    const aviso = document.getElementById('feriasAviso');
    if(!ESTA_DE_FERIAS){
      aviso.textContent = 'üèñÔ∏è Esta semana √© 100% F√âRIAS.';
      aviso.classList.add('show');
    }
  }

  // notas desktop
  if(temNotas){
    const trNotas = document.createElement('tr');
    trNotas.classList.add('notesRow');
    linhaNotas.forEach((nota)=>{
      const td = document.createElement('td');
      td.classList.add('noteCell');
      td.textContent = nota || '';
      trNotas.appendChild(td);
    });
    tbody.appendChild(trNotas);
  }

  // mobile cards
  renderMobileCards(linhaDatas, linhaHorarios, linhaNotas);
}

/* Bot√µes semana */
document.getElementById('prevWeek').addEventListener('click',()=>{
  if(semanaAtual>0) semanaAtual--;
  mostrarSemana(semanaAtual);
});
document.getElementById('nextWeek').addEventListener('click',()=>{
  if(semanaAtual<semanas.length-1) semanaAtual++;
  mostrarSemana(semanaAtual);
});

/* Modal f√©rias */
const overlay = document.getElementById('feriasOverlay');
document.getElementById('feriasBtn').addEventListener('click', ()=>{
  overlay.style.display = 'flex';
  overlay.setAttribute('aria-hidden','false');
});
document.getElementById('feriasClose').addEventListener('click', ()=>{
  overlay.style.display = 'none';
  overlay.setAttribute('aria-hidden','true');
});
overlay.addEventListener('click', (e)=>{
  if(e.target === overlay){
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
  }
});
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape' && overlay.style.display === 'flex'){
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
  }
});

/* ARRANQUE */
(async () => {
  await carregarFeriasCSV();
  updateTopCards();
  await carregarCSV();
})();
</script>

</body>
</html>
