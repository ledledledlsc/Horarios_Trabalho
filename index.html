<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Horários de Trabalho</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    .highlight { background-color: yellow; }
    button { margin: 5px; padding: 10px 15px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Horários de Trabalho</h1>
  <div>
    <button id="prevWeek">Semana anterior</button>
    <button id="nextWeek">Próxima semana</button>
  </div>
  <table id="horarios">
    <tbody></tbody>
  </table>

  <script>
    const GITHUB_CSV_URL = 'https://raw.githubusercontent.com/ledledledlsc/Horarios_Trabalho/main/Horarios_Trabalho.csv';
    let semanas = [];
    let semanaAtual = 0;

    async function carregarCSV() {
      const res = await fetch(GITHUB_CSV_URL);
      const text = await res.text();
      const linhas = text.split('\n').map(l => l.split(','));

      // Detectar semanas
      semanas = [];
      let i = 0;
      while(i < linhas.length) {
        if(linhas[i][0] && linhas[i][0].toUpperCase().includes('SEMANA')) {
          let start = i;
          let end = start + 2; // título + datas + horários
          while(end + 1 < linhas.length && linhas[end + 1][0] && !linhas[end + 1][0].toUpperCase().includes('SEMANA')) {
            end++;
          }
          semanas.push({start, end});
          i = end + 1;
        } else {
          i++;
        }
      }

      mostrarSemana(semanaAtual, linhas);
    }

    function mostrarSemana(index, linhas) {
      const tbody = document.querySelector('#horarios tbody');
      tbody.innerHTML = '';

      const semana = semanas[index];
      for(let i = semana.start; i <= semana.end; i++) {
        const tr = document.createElement('tr');
        linhas[i].forEach((celula, j) => {
          const td = document.createElement(i === semana.start ? 'th' : 'td');
          td.textContent = celula;

          // Destacar dia atual na linha de horários
          if(i === semana.start + 2) {
            const hoje = new Date();
            const diaHoje = `${hoje.getDate()}-${hoje.toLocaleString('pt-PT',{month:'short'})}`.toLowerCase();
            if(celula.toLowerCase().includes(diaHoje)) {
              td.classList.add('highlight');
            }
          }

          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      }
    }

    document.getElementById('prevWeek').addEventListener('click', () => {
      if(semanaAtual > 0) semanaAtual--;
      carregarCSV().then(() => mostrarSemana(semanaAtual, linhasCache));
    });

    document.getElementById('nextWeek').addEventListener('click', () => {
      if(semanaAtual < semanas.length - 1) semanaAtual++;
      carregarCSV().then(() => mostrarSemana(semanaAtual, linhasCache));
    });

    let linhasCache = [];
    async function iniciar() {
      const res = await fetch(GITHUB_CSV_URL);
      const text = await res.text();
      linhasCache = text.split('\n').map(l => l.split(','));
      carregarCSV();
    }

    iniciar();
  </script>
</body>
</html>
