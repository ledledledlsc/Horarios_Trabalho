<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Hor√°rios de Trabalho</title>

<!-- PWA + fullscreen mobile -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #e9f0ff, #f7f9fc);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  transition: background 0.4s, color 0.4s;
}

h1 { color: #007bff; margin: 20px 0 8px; font-size: 2.1rem; }

#semanaTitulo {
  font-size: 1.5rem;
  color: #333;
  margin: 10px 0 20px;
  font-weight: bold;
}

.buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  margin: 16px 0;
  width: 100%;
  max-width: 900px;
  padding: 0 16px;
  box-sizing: border-box;
}

button {
  padding: 12px 24px;
  font-size: 1rem;
  border-radius: 12px;
  border: none;
  background: #007bff;
  color: white;
  cursor: pointer;
  transition: all 0.3s;
  flex: 1 1 140px;
  max-width: 180px;
}

button:hover { background: #0056b3; transform: scale(1.05); }

#feriasBtn { background: #8e44ad; }
#feriasBtn:hover { background: #6f2f8a; }

#feriasBadge {
  display: none;
  margin-left: 8px;
  background: #ffcc00;
  color: #2c3e50;
  padding: 3px 9px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: bold;
  animation: pulseBadge 2s infinite;
}

@keyframes pulseBadge { 0%,100% {transform: scale(1);} 50% {transform: scale(1.08);} }

#feriasAviso, #proximasFerias {
  display: none;
  width: 90%;
  max-width: 900px;
  margin: 12px auto;
  padding: 14px;
  border-radius: 12px;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

#feriasAviso.show, #proximasFerias.show { display: block; }

#feriasAviso { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
#proximasFerias { background: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb; }

table {
  border-collapse: collapse;
  width: 90%;
  max-width: 900px;
  margin: 0 auto 40px;
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

th, td {
  border: 1px solid #ddd;
  padding: 12px 8px;
  font-size: 1rem;
}

th { background: #f5f5f5; font-weight: 600; }

.green { background: #4caf50; color: white; }
.red   { background: #f44336; color: white; }
.blue  { background: #2196f3; color: white; }
.blue-dark { background: #0d47a1; color: white; font-weight: bold; border: 2px solid #ffca28; }
.darkgray { background: #455a64; color: white; }
.gray { background: #cfd8dc; color: #333; }

.vacCell {
  background: linear-gradient(45deg, #ffe082, #ffd54f);
  background-size: 400%;
  animation: gradPulse 6s infinite;
  color: #333;
  font-weight: bold;
}

@keyframes gradPulse { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }

.today { border: 3px solid #ff9800 !important; box-shadow: 0 0 12px rgba(255,152,0,0.5); }

td:hover { transform: scale(1.04); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

#legenda {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 16px;
  margin: 20px auto;
  max-width: 900px;
  padding: 0 16px;
}

.itemLegenda { display: flex; align-items: center; gap: 8px; font-size: 0.95rem; }

.footer-logo {
  margin-top: auto;
  padding: 20px 0;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.5s;
}

.footer-logo.show { opacity: 0.5; transform: translateY(0); }

.footer-logo img { height: 48px; transition: transform 0.3s; }

.footer-logo img:hover { transform: scale(1.08); }

/* DARK MODE */
@media (prefers-color-scheme: dark) {
  body { background: linear-gradient(135deg, #121212, #1e1e1e); color: #e0e0e0; }
  table { background: #1e1e1e; }
  th { background: #2a2a2a; }
  th, td { border-color: #444; }
  #feriasAviso { background: #3a2f12; color: #ffe9b0; }
  #proximasFerias { background: #13283b; color: #bfe1ff; }
}

/* MOBILE - FULL SCREEN APP-LIKE */
@media (max-width: 600px) {
  body {
    padding: 0;
    margin: 0;
    height: 100vh;
    overflow-x: hidden;
  }

  h1 { font-size: 1.8rem; margin: 12px 0 6px; }

  #semanaTitulo { font-size: 1.3rem; margin: 8px 0 12px; }

  .buttons {
    padding: 0 8px;
    gap: 8px;
  }

  button {
    padding: 12px;
    font-size: 0.95rem;
    border-radius: 10px;
  }

  table {
    width: 100%;
    margin: 0;
    border-radius: 0;
    box-shadow: none;
  }

  th, td { padding: 10px 6px; font-size: 0.9rem; }

  #legenda {
    gap: 10px;
    padding: 0 8px;
    flex-wrap: wrap;
  }

  .footer-logo { padding: 16px 0; }
}
</style>
</head>
<body>

<h1>Hor√°rios de Trabalho</h1>

<div id="feriasAviso"></div>
<div id="proximasFerias"></div>

<div id="semanaTitulo"></div>

<div class="buttons">
  <button id="prevWeek">Semana anterior</button>
  <button id="nextWeek">Pr√≥xima semana</button>
  <button id="feriasBtn">üèñÔ∏è F√©rias <span id="feriasBadge">AGORA</span></button>
</div>

<div id="legenda">
  <div class="itemLegenda"><span class="colorBox green"></span> manh√£</div>
  <div class="itemLegenda"><span class="colorBox red"></span> tarde</div>
  <div class="itemLegenda"><span class="colorBox blue"></span> dia</div>
  <div class="itemLegenda"><span class="colorBox blue-dark"></span> Chambre de commerce</div>
  <div class="itemLegenda"><span class="colorBox darkgray"></span> Livre</div>
  <div class="itemLegenda"><span class="colorBox gray"></span> Escola</div>
  <div class="itemLegenda"><span class="colorBox vac"></span> F√©rias</div>
</div>

<table id="horarios">
  <thead><tr></tr></thead>
  <tbody></tbody>
</table>

<div class="modal-overlay" id="feriasOverlay">
  <div class="modal">
    <h3>üèñÔ∏è F√©rias</h3>
    <ul id="feriasList"></ul>
    <div style="text-align:right; margin-top:16px;">
      <button id="feriasClose">Fechar</button>
    </div>
  </div>
</div>

<div class="footer-logo" id="footerLogo">
  <a href="https://www.cactus.lu/fr" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Cactus_Logo.svg/960px-Cactus_Logo.svg.png" alt="Cactus">
  </a>
</div>

<script>
// ... (mant√©m as fun√ß√µes normalizeCell, toDateOnly, inRange, parseDateSafe, parseCSVLines, fmtDateShort, daysBetween)

// F√âRIAS (mant√©m igual ao teu c√≥digo antigo)
let FERIAS_RANGES = [];
// ... (parseFeriasCSV, getCurrentVacationRange, getVacationForDate, getNextVacation, carregarFeriasCSV, updateTopCards)

// CLASSIFICAR (vers√£o limpa sem letra inicial)
function classificarHorario(horario) {
  const raw = normalizeCell(horario).toUpperCase().trim();
  let texto = raw;
  let classe = '';

  if (raw.startsWith('M')) { classe = 'green'; texto = raw.slice(1).trim(); }
  else if (raw.startsWith('T')) { classe = 'red'; texto = raw.slice(1).trim(); }
  else if (raw.startsWith('D')) { classe = 'blue'; texto = raw.slice(1).trim(); }
  else if (raw.startsWith('N')) { classe = 'darkgray'; texto = raw.slice(1).trim(); }
  else if (raw.includes('ESCOLA')) { classe = 'gray'; texto = 'Escola'; }
  else if (/^LIBRE|LIVRE|L$/i.test(raw)) { classe = 'darkgray'; texto = 'LIBRE'; }
  else if (raw.startsWith('CDC')) { classe = 'blue-dark'; texto = 'CDC'; }

  if (raw === 'F' || raw.includes('F√âRIAS')) {
    classe = 'vacCell';
    texto = 'F√©rias';
  }

  return { classe, texto };
}

// CARREGAR CSV + DETECTAR SEMANA DO DIA ATUAL
async function carregarCSV() {
  const res = await fetch(GITHUB_CSV_URL + '?v=' + Date.now());
  const text = await res.text();
  const lines = text.trim().split(/\r?\n/).map(l => l.split(/,|;/).map(x => x.trim().replace(/^"|"$/g, '')));

  semanas = [];
  let currentWeek = [];
  for (let line of lines) {
    if (line[0] && line[0].toUpperCase().includes('SEMANA')) {
      if (currentWeek.length > 0) semanas.push(currentWeek);
      currentWeek = [line];
    } else if (line.length > 0) {
      currentWeek.push(line);
    }
  }
  if (currentWeek.length > 0) semanas.push(currentWeek);

  // Encontrar semana do dia atual
  semanaAtual = 0;
  const hoje = toDateOnly(new Date());
  for (let i = 0; i < semanas.length; i++) {
    const datas = semanas[i][1] || []; // linha das datas (2¬™ linha da semana)
    for (let d of datas) {
      const dt = parseDateSafe(d);
      if (dt && dt.getTime() === hoje.getTime()) {
        semanaAtual = i;
        break;
      }
    }
    if (semanaAtual === i) break;
  }

  mostrarSemana(semanaAtual);
}

// MOSTRAR SEMANA (t√≠tulo limpo + cabe√ßalho curto)
function mostrarSemana(idx) {
  if (!semanas[idx]) return;
  const week = semanas[idx];
  const tbody = document.querySelector('#horarios tbody');
  tbody.innerHTML = '';

  // T√≠tulo limpo
  const tituloRaw = week[0][0] || '';
  document.getElementById('semanaTitulo').textContent = tituloRaw.replace(/:.*/, '').trim().toUpperCase();

  // Cabe√ßalho com dias curtos
  const headerRow = document.querySelector('#horarios thead tr');
  headerRow.innerHTML = '';
  const datas = week[1] || [];
  datas.forEach(d => {
    const th = document.createElement('th');
    const dt = parseDateSafe(d);
    if (dt) {
      const diaSem = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'][dt.getDay()];
      th.textContent = `${diaSem} ${dt.getDate()}`;
    } else {
      th.textContent = d;
    }
    headerRow.appendChild(th);
  });

  // Hor√°rios
  for (let r = 2; r < week.length; r++) {
    const tr = document.createElement('tr');
    const cells = week[r] || [];
    cells.forEach((c, ci) => {
      const info = classificarHorario(c);
      const td = document.createElement('td');
      td.textContent = info.texto;
      if (info.classe) td.classList.add(info.classe);

      const dt = parseDateSafe(datas[ci]);
      if (dt && dt.getTime() === hoje.getTime()) td.classList.add('today');

      const vac = getVacationForDate(dt);
      if (vac) {
        td.classList.add('vacCell');
        td.textContent = 'F√©rias';
      }

      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  }

  // Anima√ß√£o simples (fade-in)
  const cells = [...tbody.querySelectorAll('td')];
  cells.forEach((c, i) => {
    c.style.opacity = 0;
    setTimeout(() => {
      c.style.transition = 'opacity 0.4s';
      c.style.opacity = 1;
    }, i * 30);
  });
}

// EVENTOS (mant√©m igual)
document.getElementById('prevWeek').onclick = () => { if (semanaAtual > 0) mostrarSemana(--semanaAtual); };
document.getElementById('nextWeek').onclick = () => { if (semanaAtual < semanas.length - 1) mostrarSemana(++semanaAtual); };
document.getElementById('feriasBtn').onclick = () => document.getElementById('feriasOverlay').classList.add('show');
document.getElementById('feriasClose').onclick = () => document.getElementById('feriasOverlay').classList.remove('show');

// INIT
(async () => {
  await carregarFeriasCSV();
  updateTopCards();
  await carregarCSV();
  document.getElementById('footerLogo').classList.add('show');
})();
</script>
</body>
</html>
